"use strict";var mountPoint=document.getElementById("screen"),MODEL={search:{inputField:m.stream("")},sources:{sourceList:m.stream([]),sourceMatches:null}};MODEL.sources.sourceMatches=m.stream.combine(function(t,e){return t().filter(function(t){return t.name.toLowerCase().match(e().toLowerCase())})},[MODEL.sources.sourceList,MODEL.search.inputField]);var CTRL={search:{processInput:function(t){t.preventDefault();var e=t.target.value;MODEL.search.inputField(e)}}},Home={navLinks:[{name:"Github",url:"https://github.com/Godje/pdt"},{name:"YouTube",url:"https://www.youtube.com/channel/UCzKW1gIGnerPbsZD-C2QNpA"},{name:"VK",url:"https://vk.com/padamtuts"}],mainNode:function(t){return{view:function(t){var e=MODEL.sources.sourceMatches().map(function(t){var e=t.name,n=t.url;return m(Home.sourceNode,{name:e,url:n})});return m(".container",[m(".title",m("h1","PaDamTuts")),m(Home.navNode),m(".subtitle",m("h2","Файлы с видео-уроков")),m(Home.inputNode),m(".output",e)])}}},navNode:function(t){return{view:function(t){return m("nav",Home.navLinks.map(function(t){return m("li",m("a",{href:t.url,target:"_blank"},t.name))}))}}},inputNode:function(t){return{view:function(t){return m(".search-container",[m("form",{onsubmit:function(t){return t.preventDefault()}},m("input[type=`text`]",{placeholder:"Type in the name of the video",oninput:CTRL.search.processInput,value:MODEL.search.inputField}))])}}},sourceNode:function(t){return{oninit:function(t){this.open=!1;var e=this;this.CTRL={toggleExpand:function(t){t.preventDefault(),e.open=!e.open}}},view:function(t){return m("div.output-block"+(this.open?".open":""),[m("button.output-title",{onclick:this.CTRL.toggleExpand},t.attrs.name),m(".content",m('a[href="'+t.attrs.url+'"]',{target:"_blank"},t.attrs.url))])}}}};m.mount(mountPoint,Home.mainNode);var owner="Godje",repo="pdt",getLastCommit=m.request({method:"GET",url:"https://api.github.com/repos/"+owner+"/"+repo+"/git/refs/heads/master"}).then(function(t){return t.object.sha}),getUrls=getLastCommit.then(function(t){return m.request({method:"GET",url:"https://api.github.com/repos/"+owner+"/"+repo+"/git/trees/"+t+"?recursive=1"}).then(function(t){var e=t.tree.filter(function(t){return t.path.match(/\[yt\]/)});return e=e.map(function(t){var e=t.path.split("[yt]");return{url:"https://github.com/Godje/pdt/tree/master/"+e[0],name:e[1]}})})}).then(MODEL.sources.sourceList);